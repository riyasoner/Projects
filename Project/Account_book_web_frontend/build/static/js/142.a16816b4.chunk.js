"use strict";(self.webpackChunkaccount_book_web=self.webpackChunkaccount_book_web||[]).push([[142],{3142:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});var a=s(5043),c=s(6140),n=s(965),l=(s(328),s(579));const r=function(){const{get:e,post:t}=(0,c.A)(),[s,r]=(0,a.useState)([]),[i,d]=(0,a.useState)(null),[o,h]=(0,a.useState)(""),m=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const s=localStorage.getItem("bookId");try{const a=await e(n.A.get_all_upcoming_collections_and_transactions,{params:{search:t,bookId:s}});if(null!==a&&void 0!==a&&a.data){const{collections:e=[],transactions:t=[]}=a.data,s=[...e,...t].sort((e,t)=>new Date(t.transaction_date)-new Date(e.transaction_date));r(s)}}catch(a){console.error("Error fetching transactions:",a.message||a)}};return(0,a.useEffect)(()=>{m()},[]),(0,a.useEffect)(()=>{const e=e=>{localStorage.getItem("bookId");m(o)};return window.addEventListener("selectedBookUpdated",e),()=>{window.removeEventListener("selectedBookUpdated",e)}},[o]),(0,l.jsxs)("div",{className:"container mt-4",children:[(0,l.jsx)("h4",{className:"mb-3 fw-bold",children:"Upcoming Transactions"}),(0,l.jsx)("div",{className:"row mb-3",children:(0,l.jsx)("div",{className:"col-md-4",children:(0,l.jsx)("input",{type:"text",className:"form-control",placeholder:"Search by category ",value:o,onChange:e=>{const t=e.target.value;h(t),m(t)}})})}),(0,l.jsx)("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"table table-bordered table-hover",children:[(0,l.jsx)("thead",{className:"table-primary",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"ID"}),(0,l.jsx)("th",{children:"Type"}),(0,l.jsx)("th",{children:"Date"}),(0,l.jsx)("th",{children:"Category"}),(0,l.jsx)("th",{children:"Description"}),(0,l.jsx)("th",{children:"To"}),(0,l.jsx)("th",{children:"Amount"})]})}),(0,l.jsx)("tbody",{children:s.length>0?s.map(e=>{var s,c;const r="COLLECTION"===e.type,o=e.emi_transaction||[],h=o.length,u=o.filter(e=>"Completed"===e.collection_status).length,x=h-u,j=r&&0===x;return(0,l.jsxs)(a.Fragment,{children:[(0,l.jsxs)("tr",{className:"".concat(r?"cursor-pointer":""," ").concat(i===e.id?"table-info":""),onClick:()=>{return r&&(t=e.id,void d(e=>e===t?null:t));var t},children:[(0,l.jsx)("td",{children:e.id}),(0,l.jsx)("td",{children:e.transaction_type}),(0,l.jsxs)("td",{children:[null===(s=e.transaction_date)||void 0===s?void 0:s.split("T")[0]," ",e.transaction_time]}),(0,l.jsx)("td",{children:e.category||"N/A"}),(0,l.jsx)("td",{children:e.description||"N/A"}),(0,l.jsx)("td",{children:e.target_acc_name||"N/A"}),(0,l.jsx)("td",{children:"".concat(r?e.coll_total_amount:e.amount," \u20b9")})]}),r&&i===e.id&&(0,l.jsx)("tr",{children:(0,l.jsxs)("td",{colSpan:"7",className:"bg-light",children:[(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)("strong",{children:"Repayment Type:"})," ",(null===(c=e.coll_kisht_type)||void 0===c?void 0:c.toUpperCase())||"N/A"]}),(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)("strong",{children:"Payment Status:"})," ",j?(0,l.jsx)("span",{className:"badge bg-success",children:"Fully Paid"}):(0,l.jsx)("span",{className:"badge bg-warning text-dark",children:"Pending"})]}),(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)("strong",{children:"EMI Summary:"}),(0,l.jsxs)("ul",{className:"ps-3 mb-0",children:[(0,l.jsxs)("li",{children:["Total EMIs: ",h]}),(0,l.jsxs)("li",{children:["Completed: ",u]}),(0,l.jsxs)("li",{children:["Pending: ",x]})]})]}),(0,l.jsx)("strong",{children:"EMI Details:"}),(0,l.jsxs)("table",{className:"table table-sm table-bordered mt-2",children:[(0,l.jsx)("thead",{className:"table-secondary",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Amount"}),(0,l.jsx)("th",{children:"Due Date"}),(0,l.jsx)("th",{children:"Status"}),(0,l.jsx)("th",{children:"Source"}),(0,l.jsx)("th",{children:"Target"}),(0,l.jsx)("th",{children:"Action"})]})}),(0,l.jsx)("tbody",{children:o.map((e,s)=>{var a;const c="Completed"===e.collection_status;return(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{children:[e.amount," \u20b9"]}),(0,l.jsx)("td",{children:null===(a=e.coll_emiDue_date)||void 0===a?void 0:a.split("T")[0]}),(0,l.jsx)("td",{children:(0,l.jsx)("span",{className:"badge ".concat(c?"bg-success":"bg-danger"),children:c?"Paid":"Unpaid"})}),(0,l.jsx)("td",{children:e.source_acc_name||"N/A"}),(0,l.jsx)("td",{children:e.target_acc_name||"N/A"}),(0,l.jsx)("td",{children:(0,l.jsx)("button",{className:"btn btn-sm ".concat(c?"btn-success":"btn-outline-success"),onClick:()=>(async e=>{try{const s={accountId:e.accountId,to_account:e.to_account,collection_status:"Completed",coll_emi_times:e.coll_emi_times,transaction_type:"COLLECTION",transaction_id:e.transaction_id},a=await t(n.A.updateCollectionStatus,s);a.status?(alert("EMI status updated successfully!"),m()):alert(a.message||"Something went wrong.")}catch(s){alert(s.message||"Error updating EMI.")}})(e),disabled:c,children:"Mark Paid"})})]},s)})})]}),(0,l.jsx)("div",{className:"text-end",children:(0,l.jsxs)("button",{className:"btn btn-sm btn-success",onClick:()=>(async e=>{try{var s;const a={accountId:e.map(e=>e.accountId),to_account:null===(s=e[0])||void 0===s?void 0:s.to_account,collection_status:"Completed"},c=await t(n.A.updateCollectionStatus,a);c.status?(alert("All EMIs marked as paid!"),m()):alert(c.message||"Error while updating.")}catch(a){alert(a.message||"Error updating all EMIs.")}})(o),disabled:j,children:[(0,l.jsx)("i",{className:"bi bi-check-circle me-1"}),"Mark All as Paid"]})})]})})]},e.id)}):(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:"7",className:"text-center",children:"No upcoming transactions found."})})})]})})]})}}}]);
//# sourceMappingURL=142.a16816b4.chunk.js.map